# 1. DNS配置

## 1.1. 宿主机配置DNS

宿主机配置DNS有两种：

1. 在对映网卡的配置文件中添加DNS。例如：

   ```shell
   vi /etc/sysconfig/network-scripts/ifcfg-ens192
   ```

   ```properties
   TYPE="Ethernet"
   PROXY_METHOD="none"
   BROWSER_ONLY="no"
   BOOTPROTO="none"
   DEFROUTE="yes"
   IPV4_FAILURE_FATAL="yes"
   IPV6INIT="yes"
   IPV6_AUTOCONF="yes"
   IPV6_DEFROUTE="yes"
   IPV6_FAILURE_FATAL="no"
   IPV6_ADDR_GEN_MODE="stable-privacy"
   NAME="ens192"
   UUID="45d23caf-3f26-455f-9ee8-02619be7ff3b"
   DEVICE="ens192"
   ONBOOT="yes"
   IPADDR="192.168.1.161"
   PREFIX="24"
   GATEWAY="192.168.1.1"
   DNS1="223.5.5.5"
   # 添加自己的DNS地址
   DNS2="192.168.1.254"
   IPV6_PRIVACY="no"
   ZONE=public
   ```

2. 修改`vi /etc/resolv.conf`文件

   ```properties
   # Generated by NetworkManager
   # 添加自己的DNS地址
   nameserver 192.168.1.254
   nameserver 223.5.5.5
   ```

## 1.2. Docker配置DNS

编辑`vi /etc/docker/daemon.json`文件，如果`daemon.json`文件不存在就创建一个。添加如下内容：

```json
{
  "dns" : [
    // 自己的DNS地址
    "192.168.1.254"
  ]
}
```

完成后重启docker服务`systemctl restart docker`

# 2. Docker配置自签证书

在每一个需要访问私有镜像仓库并且这个私有镜像仓库的https证书是自签的，那么就需要在`/etc/docker/certs.d/`这个目录下包含自签名的证书。在《harbor安装配置》中有说明。

如果`certs.d`目录不存在就创建一个。把自签名的证书放入其中，最后的目录结构如下：

```
/etc/docker/certs.d/
    └── harbor.xa:port
       ├── harbor.xa.cert  <-- Server certificate signed by CA
       ├── harbor.xa.key   <-- Server key signed by CA
       └── ca.crt               <-- Certificate authority that signed the registry certificate
```

完成后重启docker服务。

## 2.1 验证证书是否配置正确

1. `docker login harbor.xa`
2. 输入用户名密码，如果显示登录成功就说明可以使用了。